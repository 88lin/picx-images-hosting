(function(){const STORAGE_KEY='np_nonprofit_confirmed_v1';const REPORT_URL='https://bx282zvgdvv.feishu.cn/share/base/form/shrcntcJL58vkZJut2iIAHbjSif';function safeStorageGet(key){try{return window.localStorage.getItem(key)}catch(e){return null}}function safeStorageSet(key,value){try{window.localStorage.setItem(key,value)}catch(e){}}if(document.querySelector('.np-overlay')){return}function createSVGIcon(name,attrs){if(name==='shield'){return`<svg width="48"height="48"viewBox="0 0 24 24"fill="none"aria-hidden="true"focusable="false"xmlns="http://www.w3.org/2000/svg"><path d="M12 2l6 2v5c0 5-3.5 9-6 10-2.5-1-6-5-6-10V4l6-2z"fill="#4f46e5"/></svg>`}if(name==='alert'){return`<svg width="20"height="20"viewBox="0 0 24 24"fill="none"aria-hidden="true"focusable="false"xmlns="http://www.w3.org/2000/svg"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"fill="#dc2626"/><path d="M12 9v4"stroke="#fff"stroke-width="1.2"stroke-linecap="round"stroke-linejoin="round"/><path d="M12 17h.01"stroke="#fff"stroke-width="1.2"stroke-linecap="round"stroke-linejoin="round"/></svg>`}if(name==='check'){return`<svg width="20"height="20"viewBox="0 0 24 24"fill="none"aria-hidden="true"focusable="false"xmlns="http://www.w3.org/2000/svg"><path d="M20 6L9 17l-5-5"stroke="#ffffff"stroke-width="2"stroke-linecap="round"stroke-linejoin="round"/></svg>`}return''}function buildModal(){const overlay=document.createElement('div');overlay.className='np-overlay np-hidden';overlay.setAttribute('aria-hidden','true');const modal=document.createElement('div');modal.className='np-modal';modal.setAttribute('role','dialog');modal.setAttribute('aria-modal','true');modal.setAttribute('aria-label','é‡è¦å£°æ˜');modal.innerHTML=`<div style="text-align:center;"><div class="np-icon-circle"aria-hidden="true">${createSVGIcon('shield')}</div><h2 class="np-title">é‡è¦å£°æ˜</h2><div class="np-main-text"><span class="np-highlight">æœ¬å·¥å…·ä¸ºå®Œå…¨å…è´¹çš„å…¬ç›Šç½‘ç«™ï¼Œè¯·å‹¿ä»ä»»ä½•æ¸ é“è´­ä¹°ï¼</span></div></div><div class="np-warning"style="margin-bottom:18px;"><div aria-hidden="true">${createSVGIcon('alert')}</div><p><strong style="color:#b91c1c">é‡è¦æé†’ï¼š</strong>è‹¥æ‚¨åœ¨ä»»ä½•å¹³å°è´­ä¹°åˆ°æœ¬ç«™é“¾æ¥ï¼Œæ— è®ºå•†å®¶æ ‡æ³¨ä½•ç§ç†ç”±ï¼Œè¯·ç«‹å³<span style="font-weight:700">ç”³è¯·é€€æ¬¾</span>å¹¶å·®è¯„ï¼Œå°†ä¼šè”ç³»è¿æ³•åº—é“ºä¸‹æ¶æˆ–è¿½è¯‰ï¼Œæ‹’ç»å€’å–è¡Œä¸ºï¼åŒæ—¶ï¼Œä¹Ÿè¯·æ‚¨ç§¯æå®£ä¼ æœ¬ç«™ï¼Œå…±åŒä¸æ³•å•†å®¶å€Ÿæœºç‰Ÿåˆ©çš„è¡Œä¸ºã€‚</p></div><div class="np-actions"><button type="button"class="np-btn np-btn-report"id="np-report-btn"aria-label="ä¸¾æŠ¥å€’å–ä¿¡æ¯"><span style="font-size:18px">ğŸš¨</span><span>ä¸¾æŠ¥å€’å–ä¿¡æ¯</span></button><button type="button"class="np-btn np-btn-confirm"id="np-confirm-btn"aria-label="æˆ‘å·²ç†è§£å¹¶åŒæ„ç»§ç»­ä½¿ç”¨">${createSVGIcon('check')}<span>æˆ‘å·²ç†è§£å¹¶åŒæ„ç»§ç»­ä½¿ç”¨</span></button></div>`;overlay.appendChild(modal);return overlay}function trapFocus(modalRoot){const focusableSelector='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])';const focusables=modalRoot.querySelectorAll(focusableSelector);if(!focusables.length)return()=>{};const first=focusables[0];const last=focusables[focusables.length-1];function keyHandler(e){if(e.key==='Tab'){if(e.shiftKey&&document.activeElement===first){e.preventDefault();last.focus()}else if(!e.shiftKey&&document.activeElement===last){e.preventDefault();first.focus()}}}document.addEventListener('keydown',keyHandler);return function cleanup(){document.removeEventListener('keydown',keyHandler)}}function showModalOnce(){if(safeStorageGet(STORAGE_KEY)==='true')return;setTimeout(()=>{if(safeStorageGet(STORAGE_KEY)==='true')return;const overlay=buildModal();document.body.appendChild(overlay);document.body.classList.add('np-modal-open');requestAnimationFrame(()=>{overlay.classList.remove('np-hidden')});const cleanupTrap=trapFocus(overlay);const confirmBtn=overlay.querySelector('#np-confirm-btn');if(confirmBtn)confirmBtn.focus();const reportBtn=overlay.querySelector('#np-report-btn');reportBtn&&reportBtn.addEventListener('click',()=>{window.open(REPORT_URL,'_blank','noopener')});confirmBtn&&confirmBtn.addEventListener('click',()=>{safeStorageSet(STORAGE_KEY,'true');overlay.classList.add('np-hidden');setTimeout(()=>{cleanupTrap&&cleanupTrap();if(overlay.parentNode)overlay.parentNode.removeChild(overlay);document.body.classList.remove('np-modal-open')},260)});const observer=new MutationObserver((mutations)=>{if(!document.body.contains(overlay)){cleanupTrap&&cleanupTrap();observer.disconnect()}});observer.observe(document.body,{childList:true,subtree:true})},300)}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',showModalOnce)}else{showModalOnce()}})();
