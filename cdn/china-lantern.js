(()=>{const STYLE_ID="china-lantern-style-v5";const ROOT_ATTR="data-china-lantern-root-v5";const css=`:root{--cl-z:9999;--cl-top:12px;--cl-offset:40px;--cl-gap:12px;--cl-w:84px;--cl-h:68px;--cl-bg:rgba(216,0,15,0.92);--cl-border:#ffda7b;--cl-glow:rgba(255,140,63,.55);--cl-tail:#ffb74d;--cl-swing:5deg}.cl-root{position:fixed;inset:0;z-index:var(--cl-z);pointer-events:none;font-family:"华文行楷","Microsoft YaHei",system-ui,sans-serif}.cl-wrap{position:fixed;top:var(--cl-top);display:flex;gap:var(--cl-gap);align-items:flex-start}.cl-left{left:var(--cl-offset)}.cl-right{right:var(--cl-offset);flex-direction:row-reverse}.cl-unit{position:relative;width:var(--cl-w);transform-origin:50%-46px;will-change:transform;animation:cl-swing var(--swing-dur,3.8s)ease-in-out infinite alternate;animation-delay:var(--swing-delay,0s);pointer-events:none}.cl-rope{position:absolute;left:50%;top:-46px;width:2px;height:46px;transform:translateX(-50%);border-radius:999px;background:linear-gradient(to bottom,rgba(255,218,123,.95),rgba(220,143,3,.9));pointer-events:none}.cl-lantern{position:relative;width:var(--cl-w);height:var(--cl-h);border-radius:50%;background:var(--cl-bg);border:1px solid rgba(255,218,123,.25);pointer-events:auto;cursor:pointer;user-select:none;-webkit-tap-highlight-color:transparent;overflow:visible;will-change:transform}.cl-lantern::before{content:"";position:absolute;inset:-10px;border-radius:50%;background:radial-gradient(circle at 30%30%,rgba(255,170,80,.42),transparent 55%);opacity:.95;pointer-events:none}.cl-glimmer{position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 32%25%,rgba(255,255,255,.55),transparent 45%);opacity:0;pointer-events:none;will-change:opacity;animation:cl-glimmer var(--glimmer-dur,6s)ease-in-out infinite;animation-delay:var(--glimmer-delay,0s)}.cl-lantern-edge{position:absolute;left:50%;width:44px;height:7px;transform:translateX(-50%);border:1px solid var(--cl-border);background:linear-gradient(90deg,var(--cl-border),#ff8c00,var(--cl-border));opacity:.95;pointer-events:none}.cl-edge-top{top:-2px;border-radius:4px 4px 0 0}.cl-edge-bot{bottom:-2px;border-radius:0 0 4px 4px}.cl-line{position:absolute;width:2px;height:12px;background:var(--cl-border);left:50%;top:-12px;transform:translateX(-50%);opacity:.9;pointer-events:none}.cl-circle{width:80%;height:100%;margin:0 auto;border-radius:50%;border:2px solid var(--cl-border);display:flex;align-items:center;justify-content:center;box-sizing:border-box}.cl-ellipse{width:52%;height:80%;border-radius:50%;border:2px solid var(--cl-border);display:flex;align-items:center;justify-content:center;box-sizing:border-box}.cl-text{font-size:22px;font-weight:800;color:var(--cl-border);letter-spacing:1px;text-shadow:0 1px 0 rgba(0,0,0,.06)}.cl-tail{position:absolute;left:50%;bottom:-10px;transform:translateX(-50%);width:8px;height:22px;background:var(--cl-tail);border-radius:0 0 4px 4px;opacity:.95;pointer-events:none}.cl-lantern:hover{transform:translateY(-1px)}.cl-lantern:active{transform:translateY(0)scale(.99)}@keyframes cl-swing{0%{transform:rotate(calc(-1*var(--cl-swing)))}100%{transform:rotate(var(--cl-swing))}}@keyframes cl-glimmer{0%,60%,100%{opacity:0}72%{opacity:.28}80%{opacity:.12}}.cl-modal-mask{position:fixed;inset:0;display:none;align-items:center;justify-content:center;pointer-events:auto;padding:16px;background:rgba(0,0,0,.4);backdrop-filter:blur(6px)}.cl-modal-mask.is-open{display:flex}.cl-modal{width:min(440px,100%);border-radius:20px;background:rgba(255,252,245,.98);border:1px solid rgba(255,218,123,.7);box-shadow:0 18px 60px rgba(0,0,0,.22);padding:18px 18px 14px;box-sizing:border-box;animation:cl-pop.18s ease-out both}@keyframes cl-pop{from{transform:translateY(10px);opacity:.6}to{transform:translateY(0);opacity:1}}.cl-modal-title{font-size:20px;font-weight:900;color:rgba(138,27,27,.96);margin:0 0 10px 0;display:flex;align-items:center;gap:6px}.cl-modal-text{font-size:17px;line-height:1.7;color:rgba(0,0,0,.85);margin:0 0 14px 0}.cl-modal-actions{display:flex;gap:10px;justify-content:flex-end}.cl-btn{border:0;border-radius:999px;padding:9px 16px;font-size:14px;cursor:pointer;-webkit-tap-highlight-color:transparent}.cl-btn-ghost{background:rgba(0,0,0,.06);color:rgba(0,0,0,.8)}.cl-btn-primary{background:linear-gradient(135deg,#d8000f,#ff9800);color:#fff;box-shadow:0 10px 24px rgba(216,0,15,.18)}@media(max-width:460px){:root{--cl-top:8px;--cl-offset:14px;--cl-gap:8px;--cl-w:54px;--cl-h:44px;--cl-swing:2.2deg}.cl-text{font-size:14px}.cl-lantern-edge{width:28px;height:5px}.cl-tail{width:7px;height:16px;bottom:-8px}.cl-modal{width:100%;padding:16px 14px 12px}.cl-modal-title{font-size:18px}.cl-modal-text{font-size:16px}}@media(prefers-reduced-motion:reduce){.cl-unit,.cl-glimmer{animation:none!important}}`;function injectCss(){if(document.getElementById(STYLE_ID))return;const s=document.createElement("style");s.id=STYLE_ID;s.textContent=css;document.head.appendChild(s)}function removeOld(){const old=document.querySelector(`[${ROOT_ATTR}="1"]`);if(old)old.remove()}function rand(min,max){return Math.random()*(max-min)+min}function escapeHtml(str){return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const defaultBlessings=["新年快乐，万事顺意！","愿你所求皆如愿，所行皆坦途。","平安喜乐常相伴，阖家幸福乐无边。","福气满满，财运滚滚来～","岁岁常欢愉，年年皆胜意。","愿你心之所向，皆能如愿。"];function pickBlessing(opts){const pool=Array.isArray(opts.blessings)&&opts.blessings.length?opts.blessings:defaultBlessings;return pool[Math.floor(Math.random()*pool.length)]}function ensureModal(root,opts){let mask=root.querySelector(".cl-modal-mask");if(mask)return mask;mask=document.createElement("div");mask.className="cl-modal-mask";mask.innerHTML=`<div class="cl-modal"role="dialog"aria-modal="true"aria-label="新年祝福"><div class="cl-modal-title"><span>新年祝福</span></div><p class="cl-modal-text"></p><div class="cl-modal-actions"><button class="cl-btn cl-btn-ghost"data-action="another">换一句</button><button class="cl-btn cl-btn-primary"data-action="close">收下祝福</button></div></div>`;root.appendChild(mask);const modal=mask.querySelector(".cl-modal");const textEl=mask.querySelector(".cl-modal-text");const closeBtn=mask.querySelector('[data-action="close"]');const anotherBtn=mask.querySelector('[data-action="another"]');const close=()=>mask.classList.remove("is-open");const open=(msg)=>{textEl.textContent=msg;mask.classList.add("is-open")};mask.addEventListener("click",close);modal.addEventListener("click",(e)=>e.stopPropagation());closeBtn.addEventListener("click",(e)=>{e.stopPropagation();close()});anotherBtn.addEventListener("click",(e)=>{e.stopPropagation();textEl.textContent=pickBlessing(opts)});const onKey=(e)=>{if(e.key==="Escape")close()};document.addEventListener("keydown",onKey);mask.__open=open;mask.__cleanup=()=>document.removeEventListener("keydown",onKey);return mask}function openBlessing(opts){const root=document.querySelector(`[${ROOT_ATTR}="1"]`);if(!root)return;const mask=ensureModal(root,opts);mask.__open(pickBlessing(opts))}function createUnit(char,opts){const unit=document.createElement("div");unit.className="cl-unit";unit.style.setProperty("--swing-dur",`${rand(opts.swingMin,opts.swingMax).toFixed(2)}s`);unit.style.setProperty("--swing-delay",`${rand(0,0.8).toFixed(2)}s`);const rope=document.createElement("div");rope.className="cl-rope";const lantern=document.createElement("div");lantern.className="cl-lantern";lantern.setAttribute("role","button");lantern.setAttribute("aria-label",`打开祝福：${char}`);lantern.innerHTML=`<div class="cl-line"></div><div class="cl-lantern-edge cl-edge-top"></div><div class="cl-lantern-edge cl-edge-bot"></div><div class="cl-circle"><div class="cl-ellipse"><div class="cl-text">${escapeHtml(char)}</div></div></div><div class="cl-tail"></div><div class="cl-glimmer"></div>`;const glimmer=lantern.querySelector(".cl-glimmer");glimmer.style.setProperty("--glimmer-dur",`${rand(opts.glimmerMin,opts.glimmerMax).toFixed(2)}s`);glimmer.style.setProperty("--glimmer-delay",`${rand(0,3).toFixed(2)}s`);lantern.addEventListener("click",(e)=>{e.stopPropagation();openBlessing(opts)});unit.appendChild(rope);unit.appendChild(lantern);return unit}function createWrap(side,chars){if(!chars||!chars.length)return null;const el=document.createElement("div");el.className=`cl-wrap cl-${side}`;return el}function injectCssOnce(){if(!document.getElementById(STYLE_ID)){injectCss()}}function init(options={}){injectCssOnce();removeOld();const opts={leftTexts:["新","年"],rightTexts:["乐","快"],blessings:null,swingMin:3.6,swingMax:4.6,glimmerMin:5,glimmerMax:8,zIndex:9999,...options};const root=document.createElement("div");root.className="cl-root";root.setAttribute(ROOT_ATTR,"1");root.style.zIndex=String(opts.zIndex);document.body.appendChild(root);const left=createWrap("left",opts.leftTexts);if(left){opts.leftTexts.forEach((c)=>left.appendChild(createUnit(c,opts)));root.appendChild(left)}const right=createWrap("right",opts.rightTexts);if(right){opts.rightTexts.forEach((c)=>right.appendChild(createUnit(c,opts)));root.appendChild(right)}root.__cleanupModal=()=>{const mask=root.querySelector(".cl-modal-mask");if(mask&&mask.__cleanup)mask.__cleanup()};return root}function destroy(){const root=document.querySelector(`[${ROOT_ATTR}="1"]`);if(root&&root.__cleanupModal)root.__cleanupModal();removeOld()}function auto(){init({leftTexts:["新","年"],rightTexts:["乐","快"]})}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",auto)}else{auto()}window.ChinaLantern={init,destroy}})();
